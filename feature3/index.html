<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Feature 3: Transportation Planning</title>

  <!-- Clean, modern fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet"/>

  <!-- Leaflet + Leaflet Routing Machine (no API key needed) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>

  <style>
    :root{
            /* Dark Jungle Green theme */
            --primary:#1A2421;        /* Dark Jungle Green */
            --primary-600:#20332E;    /* Slightly lighter */
            --primary-700:#0F1916;    /* Deeper shade */

            --bg:#F4F8F6;             /* soft light backdrop */
            --bg-2:#ECF3F0;
            --surface:#FFFFFF;
            --ink:#1D2523;            /* readable dark text */
            --muted:#6E7F7A;          /* muted text */

            --accent:#9FE6C9;         /* soft mint accent for highlights */
            --teal:#2DD4BF;           /* teal accent */
            --amber:#F4C95D;

            --border:#E2ECE8;
            --ring:#1A242133;

            --radius: 14px;
            --radius-lg: 20px;

            --shadow-sm: 0 8px 22px rgba(26, 36, 33, .08);
            --shadow-md: 0 16px 44px rgba(26, 36, 33, .12);
            --shadow-lg: 0 26px 70px rgba(26, 36, 33, .18);

            --transition: all .28s ease; 
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; min-height:100vh; padding:20px; line-height:1.6; }
    .container{ max-width:1400px; margin:0 auto; background:var(--surface); color:var(--ink); border-radius:22px; border:1px solid var(--border); box-shadow:var(--shadow-lg); overflow:hidden; }
    .header{ background: radial-gradient(140% 120% at 100% 0%, #2F4A43, transparent 60%), linear-gradient(120deg, var(--primary) 0%, var(--primary-600) 100%); color:#F2FFFC; padding:36px 30px; text-align:center; position:relative; overflow:hidden; }
    .header::after{ content:""; position:absolute; right:-120px; top:-140px; width:520px; height:520px; border-radius:50%; background:rgba(255,255,255,.12); filter:blur(50px); pointer-events:none; }
    .header h1{ font-family:Poppins, sans-serif; font-size:clamp(1.9rem,3.8vw,2.6rem); margin-bottom:10px; line-height:1.15; letter-spacing:.2px; }
    .header p{ font-size:clamp(.95rem,2vw,1.1rem); opacity:.95; max-width:900px; margin:0 auto; }

    .content{ padding:30px; background:#FFFFFF; color:#1A2421; }

    .stats-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:20px; margin-bottom:30px; }
    .stat-card {
        position: relative;
        background: linear-gradient(180deg, #ffffff, #F6FAF8);
        border: 1px solid var(--border);
        color: var(--ink);
        padding: 24px 22px;
        border-radius: 18px;
        text-align: center;
        box-shadow: var(--shadow-sm);
        overflow: hidden;
        -webkit-text-fill-color: #079e69;
      }

    .stat-card::before{
            content:""; position:absolute; inset:auto auto -30% -30%;
            width: 220px; height: 220px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(159,230,201,.4), transparent 60%);
            filter: blur(8px);
      }
    .stat-number{
        font-size: 2.3rem;
        font-weight: 800;
        margin-bottom: 6px;
        background: linear-gradient(90deg, #9FE6C9, #1f8577);
        -webkit-background-clip: text; background-clip: text; color: transparent;
      }
    .stat-label{
        font-size: 1rem; color: var(--muted); font-weight: 600;
      }
    .tabs{ display:flex; margin-bottom:30px; border-bottom:2px solid #E6ECEA; gap:6px; flex-wrap:wrap; }
    .tab-btn{ padding:15px 30px; border:none; background:none; cursor:pointer; font-size:16px; font-weight:700; color:#666; border-bottom:3px solid transparent; transition:var(--transition); border-radius:10px 10px 0 0; }
    .tab-btn:hover{ color:#1A2421; background:#F6F9F8; }
    .tab-btn.active{ color:#1A2421; border-bottom-color:#C9DAD5; }
    .tab-content{ display:none; }
    .tab-content.active{ display:block; }

    .section{ margin-bottom:40px; }
    .section h2{ font-size:clamp(1.2rem,2.6vw,1.6rem); color:#1A2421; margin-bottom:16px; font-weight:700; padding-bottom:10px; border-bottom:3px solid #E6ECEA; }

    .controls{ display:flex; gap:15px; margin-bottom:20px; flex-wrap:wrap; align-items:center; }
    .search-box{ padding:12px 14px; border:2px solid #E0E6E4; border-radius:12px; font-size:14px; width:300px; transition:var(--transition); background:#FFFFFF; color:#1A2421; box-shadow:inset 0 1px 0 rgba(0,0,0,.02); }
    .search-box::placeholder{ color:#8A9794; }
    .search-box:focus{ outline:none; border-color:#C9DAD5; box-shadow:0 0 0 4px var(--ring); }

    .btn{ padding:12px 24px; border:none; border-radius:12px; cursor:pointer; font-size:14px; font-weight:700; transition:var(--transition); text-decoration:none; display:inline-block; color:#fff; }
    .btn-primary{ background:linear-gradient(180deg, var(--primary-600), var(--primary)); box-shadow:var(--shadow-sm); }
    .btn-primary:hover{ transform:translateY(-2px); box-shadow:var(--shadow-md); }
    .btn-secondary{ background:#2BAA78; }
    .btn-secondary:hover{ background:#228B63; }
    .btn-view{ background:#007bff; padding:6px 12px; font-size:12px; border-radius:10px; }
    .btn-view:hover{ background:#0056b3; }
    .btn-edit{ background:#22C55E; padding:6px 12px; font-size:12px; border-radius:10px; }
    .btn-edit:hover{ background:#16A34A; }
    .btn-delete{ background:#EF4444; padding:6px 12px; font-size:12px; border-radius:10px; }
    .btn-delete:hover{ background:#DC2626; }

    .table-container{ overflow-x:auto; border-radius:16px; border:1px solid #E6ECEA; box-shadow:var(--shadow-sm); background:#FFFFFF; }
    table{ width:100%; border-collapse:collapse; background:transparent; font-size:14px; color:#1A2421; }
    th{ position:sticky; top:0; z-index:1; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)), linear-gradient(120deg, var(--primary) 0%, var(--primary-600) 100%); color:#F2FFFC; padding:14px; text-align:left; font-weight:800; letter-spacing:.2px; border-bottom:1px solid #21322D; }
    td{ padding:12px 15px; border-bottom:1px solid #E0E6E4; vertical-align:middle; }
    tr:hover{ background-color:#F3F7F6; transition:background .18s ease; }
    .status-badge{ padding:4px 12px; border-radius:20px; font-size:12px; font-weight:700; text-transform:uppercase; }
    .status-planned{ background:#cce5ff; color:#0066cc; }
    .status-transit{ background:#fff3cd; color:#856404; }
    .status-delivered{ background:#d4edda; color:#155724; }
    .status-pending{ background:#f8d7da; color:#721c24; }
    .status-default{ background:#e2e3e5; color:#383d41; }
    .modal{
      display: none;
      position: fixed; inset: 0;
      z-index: 1000;
      background: rgba(0,0,0,.55);
      padding: 20px;
      overflow: auto;
    }
    .modal-content{
      background: #111B18;
      color: #E8F6F2;
      backdrop-filter: blur(6px);
      margin: 5% auto;
      padding: 24px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
      animation: slideIn .22s ease-out;
    }
    .modal-header{
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px;
      padding-bottom: 10px; border-bottom: 1px solid var(--border);
    }
    .modal-header h3{
      font-size: 1.25rem; color: #D5EEE7;
    }
    .close{
      color: #A3B1AD; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1;
    }
    .close:hover{ color: #F2FFFC; }
    .form-group{ margin-bottom: 16px; }
    .form-group label{
      display: block; margin-bottom: 6px; font-weight: 700; color: #D6E9E4; font-size: .95rem;
    }
    .form-group input,
    .form-group select{
      width: 100%;
      padding: 12px 12px;
      border: 1.8px solid #2B3B37;
      border-radius: 12px;
      font-size: 14px;
      transition: var(--transition);
      background: #0F1916;
      color: #EAF5F1;
    }
    .form-group input::placeholder,
    .form-group select::placeholder { color: #8AA39C; }
    .form-group input:focus,
    .form-group select:focus{
      outline: none;
      border-color: #2E4A42;
      box-shadow: 0 0 0 4px var(--ring);
    }
    .modal-footer{
      display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px;
    }
    @keyframes slideIn{ from{ transform:translateY(18px); opacity:0; } to{ transform:translateY(0); opacity:1; } }
    @media (prefers-reduced-motion: reduce){ *{ animation:none !important; transition:none !important; } }
    @media (max-width:768px){ .controls{ flex-direction:column; } .search-box{ width:100%; } .header h1{ font-size:2rem; } .content{ padding:20px; } .stats-grid{ grid-template-columns:1fr; } .tabs{ flex-direction:column; } th{ font-size:13px; } td{ font-size:13px; } }

    /* small helper */
    .text-center { text-align:center; }
    /* Map box */
    #map { height: 420px; border-radius:16px; overflow:hidden; border:1px solid #E6ECEA; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Transportation Planning</h1>
      <p>Plan and schedule transportation activities, assign vehicles and drivers, and determine optimal routes based on distance, road conditions, and delivery timelines.</p>
    </div>

    <div class="content">
      <!-- Transportation Statistics -->
      <div class="section">
        <h2>Transportation Overview</h2>
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-number" id="totalShipments">0</div><div class="stat-label">Total Shipments</div></div>
          <div class="stat-card"><div class="stat-number" id="activeTransports">0</div><div class="stat-label">Active Transports</div></div>
          <div class="stat-card"><div class="stat-number" id="availableDrivers">0</div><div class="stat-label">Available Drivers</div></div>
          <div class="stat-card"><div class="stat-number" id="pendingShipments">0</div><div class="stat-label">Pending Shipments</div></div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" onclick="showTab('shipments')">Shipment Planning</button>
        <button class="tab-btn" onclick="showTab('transports')">Transport Management</button>
      </div>

      <!-- Shipments Tab -->
      <div id="shipmentsTab" class="tab-content" style="display:block;">
        <div class="section">
          <h2>Shipment Planning</h2>
          <div class="controls">
            <button class="btn btn-primary" onclick="openShipmentModal()">+ Plan Shipment</button>
            <button class="btn btn-secondary" onclick="refreshData()">ðŸ”„ Refresh</button>
            <input type="text" class="search-box" id="shipmentSearch" placeholder="Search shipments..." onkeyup="searchShipments()">
          </div>
          <div class="table-container">
            <table id="shipmentsTable">
              <thead>
                <tr>
                  <th>Shipment ID</th>
                  <th>Shipment Date</th>
                  <th>Destination</th>
                  <th>Status</th>
                  <th>Assigned Transport</th>
                  <th>Driver</th>
                  <th>Product</th>
                  <th>Transportation Cost</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="shipmentsTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Shipment Progress -->
        <div class="section" style="margin-top:26px;">
          <h2>Shipment Progress</h2>
          <div class="controls">
            <button class="btn btn-primary" onclick="openProgressModal()">ðŸšš Dispatch Shipment</button>
          </div>
          <div class="table-container">
            <table id="shipmentProgressTable">
              <thead>
                <tr>
                  <th>Shipment ID</th>
                  <th>Dispatch Date</th>
                  <th>Dispatch Time</th>
                  <th>Destination</th>
                  <th>Current Location</th>
                  <th>Remaining Distance (km)</th>
                  <th>Route</th>
                  <th>ETA</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="shipmentProgressTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Map Section (Leaflet) -->
        <div class="section" id="mapSection">
          <h2>Live Route</h2>
          <div id="map"></div>
        </div>
      </div>

      <!-- Transports Tab -->
      <div id="transportsTab" class="tab-content">
        <div class="section">
          <h2>Transport Management</h2>
          <div class="controls">
            <button class="btn btn-primary" onclick="openTransportModal()">+ Add Transport</button>
            <button class="btn btn-secondary" onclick="refreshData()">ðŸ”„ Refresh</button>
          </div>
          <div class="table-container">
            <table id="transportsTable">
              <thead>
                <tr>
                  <th>Transport ID</th>
                  <th>Vehicle Type</th>
                  <th>Capacity</th>
                  <th>Current Load</th>
                  <th>Driver</th>
                  <th>Phone</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="transportsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Shipment Modal -->
  <div id="shipmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="shipmentModalTitle">Plan New Shipment</h3>
        <span class="close" onclick="closeShipmentModal()">&times;</span>
      </div>
      <form id="shipmentForm">
        <div class="form-group">
          <label for="transportSelect">Assigned Transport *</label>
          <select id="transportSelect" required><option value="">Select Transport</option></select>
        </div>
        <div class="form-group">
          <label for="transportationCost">Transportation Cost</label>
          <input type="number" id="transportationCost" step="0.01" min="0" placeholder="e.g., 2500.00">
        </div>
        <div class="form-group">
          <label for="harvestBatchSelect">Harvest Batch</label>
          <select id="harvestBatchSelect"><option value="">Select Harvest Batch (Optional)</option></select>
        </div>
        <div class="form-group">
          <label for="packagedBatchSelect">Packaged Product</label>
          <select id="packagedBatchSelect"><option value="">Select Packaged Product (Optional)</option></select>
        </div>
        <div class="form-group">
          <label for="shipmentDate">Shipment Date *</label>
          <input type="date" id="shipmentDate" required>
        </div>
        <div class="form-group">
          <label for="shipmentDestination">Destination *</label>
          <select id="shipmentDestination" required>
            <option value="">Select Destination</option>
            <option>Dhaka, Bangladesh</option>
            <option>Chittagong, Bangladesh</option>
            <option>Khulna, Bangladesh</option>
            <option>Rajshahi, Bangladesh</option>
            <option>Sylhet, Bangladesh</option>
          </select>
        </div>
        <div class="form-group">
          <label for="shipmentStatus">Status *</label>
          <select id="shipmentStatus" required>
            <option value="">Select Status</option>
            <option value="Planned">Planned</option>
            <option value="In Transit">In Transit</option>
            <option value="Delivered">Delivered</option>
            <option value="Pending">Pending</option>
          </select>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeShipmentModal()">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveShipment()">Save Shipment</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Transport Modal -->
  <div id="transportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="transportModalTitle">Add New Transport</h3>
        <span class="close" onclick="closeTransportModal()">&times;</span>
      </div>
      <form id="transportForm">
        <div class="form-group">
          <label for="transportDriverSelect">Driver *</label>
          <select id="transportDriverSelect" required><option value="">Select Driver</option></select>
        </div>
        <div class="form-group">
          <label for="vehicleType">Vehicle Type *</label>
          <select id="vehicleType" required>
            <option value="">Select Vehicle Type</option>
            <option value="Truck">Truck</option>
            <option value="Van">Van</option>
            <option value="Refrigerated Truck">Refrigerated Truck</option>
            <option value="Trailer">Trailer</option>
          </select>
        </div>
        <div class="form-group">
          <label for="vehicleCapacity">Vehicle Capacity (kg) *</label>
          <input type="number" id="vehicleCapacity" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="currentCapacity">Current Capacity (kg)</label>
          <input type="number" id="currentCapacity" step="0.01" value="0">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeTransportModal()">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveTransport()">Save Transport</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Shipment Progress Modal -->
  <div id="progressModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="progressModalTitle">Log Shipment Progress</h3>
        <span class="close" onclick="closeProgressModal()">&times;</span>
      </div>
      <form id="progressForm">
        <div class="form-group">
          <label for="progressShipmentSelect">Shipment *</label>
          <select id="progressShipmentSelect" required onchange="onProgressShipmentChanged()">
            <option value="">Select Shipment</option>
          </select>
        </div>
        <div class="form-group">
          <label for="progressDestination">Destination</label>
          <input type="text" id="progressDestination" readonly>
        </div>
        <div class="form-group">
          <label for="progressRouteSelect">Route *</label>
          <select id="progressRouteSelect" required><option value="">Select Route</option></select>
        </div>
        <div class="form-group">
          <label for="progressDispatchTime">Dispatch Time *</label>
          <input type="datetime-local" id="progressDispatchTime" required>
        </div>
        <div class="form-group">
          <small>Current location, remaining distance, and ETA will be auto-filled from seed data on save.</small>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeProgressModal()">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveShipmentProgress()">Save Progress</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Leaflet JS (must come before your script.js) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

  <script src="script.js"></script>
</body>
</html>
